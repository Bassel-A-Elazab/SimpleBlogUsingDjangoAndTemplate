{% extends 'blog/base.html' %}
{% load static i18n %}
{% block head_title %}{{ blog.title }}{% endblock %}

{% block content %}

{{ user.is_authenticated|json_script:"is_authenticated" }}

{% if blog.cover %}
<div>
    <img src="{{ blog.cover.url }}" alt="{{ blog.title }}" class="rounded"
        style="height: 400px; width:100%; object-fit: cover;" />
</div>
{% endif %}

<section>
    <div class="row my-lg-3">
        <div class="col-lg-8 col-md-8 mx-auto">
            <div class="text-center">
                <div class="d-flex align-items-center gap-2">
                    <a href="{{ blog.author.get_absolute_url  }}"
                        class="d-block link-body-emphasis text-decoration-none" aria-expanded="false">
                        <img src="{{ blog.author.picture.url }}" alt="{{blog.author.email}}" width="32" height="32"
                            class="rounded-circle">
                    </a>
                    <div class="d-flex flex-column align-items-start">
                        <a class="link-body-emphasis text-decoration-none" href="{{ blog.author.get_absolute_url }}">
                            {{ blog.author.name }}</a>
                        <small class="text-secondary">{{ blog.post_date | date }}</small>
                    </div>
                </div>
                <h1 class="mb-4">{{ blog.title }}</h1>
                <small class="text-secondary">
                    {% for tag in blog.tags.all %}
                    #{{ tag }}
                    {% endfor %}
                </small>
            </div>
            <p class="lead text-justify my-4">{{ blog.description }}</p>
        </div>
    </div>
</section>

<section>
    <h2>{% trans "Top comments" %} ({{ blog.blogcomment_set.count }})</h2>
    <div class="d-flex gap-2 my-3">
        <a href="{{ blog.author.get_absolute_url  }}" class="d-block link-body-emphasis text-decoration-none mt-2"
            aria-expanded="false">
            <img src="{{ blog.author.picture.url }}" alt="{{blog.author.email}}" width="32" height="32"
                class="rounded-circle">
        </a>
        <div class="col-md-6">
            <form method="post">
                {% csrf_token %}
                <textarea class="form-control" id="blogCommentTextarea" rows="3" placeholder="Add to the discussion"
                    name="{{ form.comment.name }}" value="{{ form.comment.value|default:'' }}"></textarea>
                <button class="btn btn-dark py-2 my-2" type="submit">{% trans 'Submit' %}</button>
            </form>
        </div>
    </div>
</section>

{% for comment in blog.blogcomment_set.all %}
<div class="d-flex gap-2 my-3">
    <a href="{{ blog.author.get_absolute_url  }}" class="d-block link-body-emphasis text-decoration-none mt-2"
        aria-expanded="false">
        <img src="{{ comment.author.picture.url }}" alt="{{blog.author.email}}" width="32" height="32"
            class="rounded-circle">
    </a>
    <div class="col-md-6">
        <div class="p-2 border rounded-3">
            <small class="fs-5 text-secondary">{{ comment.author.name }}</small>
            <small class="text-secondary">. {{ comment.comment_date | date }}</small>
            <p class="fw-light text-justify my-2">{{ comment.comment }}</p>
        </div>
    </div>
</div>
{% endfor %}

<!-- Blog Comment Modal -->
<div class="modal fade" id="blogCommentModal" tabindex="-1" aria-labelledby="blogCommentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>{% trans "You're almost there! To leave a comment, please log in or create an account." %}</p>
                <p>{% trans "We can't wait to hear what you have to say!" %}</p>
            </div>
            <div class="modal-footer">
                <a type="button" class="btn btn-outline-dark" href="{% url 'account_login' %}">Log in</a>
                <a type="button" class="btn btn-dark" href="{% url 'account_signup' %}">Create account</a>
            </div>
        </div>
    </div>
</div>

{% endblock %}